{% extends "base.html" %}

{% block title %}Assistente Virtual - Change Life Academy{% endblock %}

{% block content %}
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark gym-navbar">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('dashboard') }}">
            <i class="bi bi-arrow-left"></i> Voltar ao √çnicio
        </a>
        <div class="navbar-nav ms-auto">
            <span class="navbar-text">
                <i class="bi bi-person-circle"></i> {{ user.name }}
            </span>
        </div>
    </div>
</nav>

<!-- Chatbot Content -->
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="chatbot-container">
                <!-- Header -->
                <div class="chatbot-header">
                    <div class="chatbot-avatar">
                        <i class="bi bi-emoji-smile"></i>
                    </div>
                    <div class="chatbot-info">
                        <h4>Happy</h4>
                        <p>Assistente Virtual da Change Life Academy</p>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="chatbot-messages" id="chatbotMessages">
                    <div class="message bot-message">
                        <div class="message-content">
                            <i class="bi bi-emoji-smile"></i>
                            <div class="message-text">
                                <p>Ol√°, {{ user.name }}! üëã</p>
                                <p>Meu nome √© <strong>Happy</strong> e sou a assistente virtual da Change Life Academy! üòä</p>
                                <p>Estou aqui para te ajudar a conhecer nossa empresa e responder todas as suas d√∫vidas sobre nossa cultura, estrutura e benef√≠cios.</p>
                                <p>Fico muito feliz em te receber em nossa equipe! üéâ</p>
                                <p>Escolha uma das op√ß√µes abaixo para come√ßarmos nossa conversa:</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="message-content">
                        
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>

                <!-- Options -->
                <div class="chatbot-options">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('quem-somos')">
                                <span>Quem Somos</span>
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('missao-visao-valores')">
                                <span>Miss√£o, Vis√£o e Valores</span>
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('departamentos')">
                                <span>Departamentos</span>
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('beneficios')">
                                <span>Benef√≠cios</span>
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('estrutura-hierarquica')">
                                <span>Estrutura Hier√°rquica</span>
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('feedbacks')">
                                <span>Feedbacks</span>
                            </button>
                        </div>
                        <div class="col-md-12 mb-3">
                            <button class="btn chatbot-option" onclick="showInfo('Duvidas Frequentes')">
                                <span>Duvidas Frequentes</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Back to Dashboard -->
                <div class="text-center mt-4">
                    <a href="{{ url_for('dashboard') }}" class="btn gym-btn">
                        <i class="bi bi-house"></i> Voltar ao √çnicio
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showInfo(topic) {
    const messagesContainer = document.getElementById('chatbotMessages');
    const typingIndicator = document.getElementById('typingIndicator');
    
    // Remove active class from all options
    document.querySelectorAll('.chatbot-option').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to clicked option
    event.target.closest('.chatbot-option').classList.add('active');
    
    // Clear previous messages and show typing indicator
    messagesContainer.innerHTML = '';
    typingIndicator.style.display = 'block';
    
    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    // Simulate typing delay
    setTimeout(() => {
        typingIndicator.style.display = 'none';
        typeMessage(topic);
    }, 800);
}

function typeMessage(topic) {
    const messagesContainer = document.getElementById('chatbotMessages');
    let content = '';
    
    switch(topic) {
        case 'quem-somos':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        <div class="message-text">
                            <h5><i class="bi bi-building"></i> Quem Somos</h5>
                            <div class="typed-text mb-3">
                                <p><em>Nada melhor do que ouvir direto de quem ajudou a criar tudo! O Vitor, um dos nossos fundadores, explica rapidinho quem somos.</em></p>
                            </div>
                            <div class="ratio ratio-16x9">
                                <video controls preload="metadata" poster="{{ url_for('static', filename='image/logo.png') }}">
                                    <source src="{{ url_for('static', filename='video/quem_somos.mp4') }}" type="video/mp4">
                                </video>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            break;
            
        case 'missao-visao-valores':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-eye"></i> Miss√£o, Vis√£o e Valores</h5>
                            <div class="typed-text mb-3">
                                <p>Essa √© uma das minhas partes favoritas para compartilhar! ‚ú®</p>
                            </div>
                            
                            <p><strong>üéØ Miss√£o</strong><br>
                            Transformar a vida das pessoas por meio da atividade f√≠sica e atendimento humanizado, com √™nfaze na performance, qualidade de vida, promovendo bem-estar e sa√∫de emocional üí™</p>
                            
                            <p><strong>üëÅÔ∏è Vis√£o</strong><br>
                            Ser reconhecida nacionalmente como a melhor academia em promo√ß√£o a sa√∫de mental, acolhimento social e uso de tecnologia de ponta, tornando-se referencia e alcan√ßando o maior indice de alunos fidelizados com meta em expans√£o nos pr√≥ximos 5 anos em diversas cidades üåü</p>
                            
                            <p><strong>‚ù§Ô∏è Valores</strong><br>
                            Muito mais que uma academia de ver√£o: um estilo de vida! colocamos nossos alunos no centro, prezando por um atendimento humano e emp√°tico. Promovemos mudan√ßas e melhorias para todos que buscam uma vida saud√°vel e equilibrada, buscando sempre as melhores tecnologias para proporcionar experiencias √∫nicas</p>
                        </div>
                    </div>
                </div>
            `;
            break;
            
        case 'departamentos':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-diagram-3"></i> Departamentos</h5>
                            <div class="typed-text mb-3">
                                <p>Quer entender melhor como cada parte da empresa trabalha em conjunto? D√° uma olhada na estrutura dos nossos departamentos.</p>
                            </div>
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <div class="p-3 bg-white rounded h-100 shadow-sm" style="border-left: 4px solid #F59E0B;"> <!-- amber -->
                                        <h6 class="mb-1 text-uppercase"><i class="bi bi-briefcase me-2 text-warning"></i>Diretoria Executiva</h6>
                                        <div class="text-muted small mb-2">Liderar estrategicamente a Change Life Academy</div>
                                        <ul class="mb-0">
                                            <li>Diretor(a)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="p-3 bg-white rounded h-100 shadow-sm" style="border-left: 4px solid #10B981;"> <!-- emerald -->
                                        <h6 class="mb-1 text-uppercase"><i class="bi bi-cash-coin me-2 text-success"></i>Planejamento Financeiro</h6>
                                        <div class="text-muted small mb-2">Gerenciar os recursos financeiros da academia</div>
                                        <ul class="mb-0">
                                            <li>Gerente Financeiro(a)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="p-3 bg-white rounded h-100 shadow-sm" style="border-left: 4px solid #3B82F6;"> <!-- blue -->
                                        <h6 class="mb-1 text-uppercase"><i class="bi bi-gear me-2 text-primary"></i>Gest√£o e Opera√ß√µes</h6>
                                        <div class="text-muted small mb-2">Assegurar o funcionamento eficiente das opera√ß√µes</div>
                                        <ul class="mb-0">
                                            <li>Gerente Operacional</li>
                                            <li>Gest√£o de Pessoas</li>
                                            <li>Preparador(a) f√≠sica(a)</li>
                                            <li>Recepcionista</li>
                                            <li>Estagi√°rio(a) de Educa√ß√£o F√≠sica</li>
                                        </ul>
                            </div>
                            </div>
                                <div class="col-12 col-md-6">
                                    <div class="p-3 bg-white rounded h-100 shadow-sm" style="border-left: 4px solid #06B6D4;"> <!-- cyan -->
                                        <h6 class="mb-1 text-uppercase"><i class="bi bi-cpu me-2 text-info"></i>Transforma√ß√£o Digital</h6>
                                        <div class="text-muted small mb-2">Planejar estrat√©gias Digitais</div>
                                        <ul class="mb-0">
                                            <li>Analista de marketing</li>
                                            <li>Analista de Sistemas</li>
                                            <li>Estagi√°rio(a) de T.I</li>
                                        </ul>
                            </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            break;
            
        case 'beneficios':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-gift"></i> Benef√≠cios</h5>
                            <div class="typed-text mb-3">
                                <p>Confira os benef√≠cios oferecidos aos nossos colaboradores:</p>
                            </div>
                            <ul>
                                <li>Acesso gratuito √† academia ou desconto especial em planos</li>
                                <li>Programas de sa√∫de e bem-estar (check-ups, acompanhamento nutricional, aulas exclusivas)</li>
                                <li>Descontos em parceiros (lojas de suplementos, spas, cl√≠nicas est√©ticas)</li>
                                <li>Desafio interno de metas fitness com premia√ß√µes</li>
                                <li>Aulas e workshops exclusivos com treinadores da academia</li>
                                <li>Vale-transporte</li>
                                <li>Vale-refei√ß√£o ou vale - alimenta√ß√£o (cart√£o flex√≠vel √© uma tend√™ncia)</li>
                                <li>Plano de sa√∫de (com coparticipa√ß√£o ou integral)</li>
                                <li>Plano odontol√≥gico</li>
                                <li>Aux√≠lio - creche (para pais e m√£es colaboradores)</li>
                                <li>Subs√≠dio para cursos externos e certifica√ß√µes na √°rea fitness</li>
                                <li>Plano de carreira estruturado</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            break;
            
        case 'estrutura-hierarquica':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-diagram-2"></i> Estrutura Hier√°rquica</h5>
                            <div class="typed-text mb-3">
                                <p>Pra visualizar melhor como trabalhamos juntos, aqui est√° uma vis√£o da estrutura das nossas √°reas.</p>
                            </div>
                            <div class="text-center mt-3">
                                <img src="{{ url_for('static', filename='image/orgonograma.jpg') }}" alt="Organograma - Estrutura das √Åreas" class="img-fluid rounded shadow-sm">
                                </div>
                                </div>
                                </div>
                                </div>
            `;
            break;
        
        case 'feedbacks':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-chat-dots"></i> Feedbacks</h5>
                            <div class="typed-text mb-3">
                                <p>üé• Confira o feedback de alguns de nossos colaboradores.</p>
                                <p>Eles compartilham como tem sido fazer parte dessa jornada de crescimento, prop√≥sito e transforma√ß√£o.</p>
                                <p>‚ú® Inspire-se com essas hist√≥rias e veja o impacto de viver a cultura Change Life Academy de perto.</p>
                            </div>
                            <div class="ratio ratio-16x9 mb-3">
                                <video controls preload="metadata">
                                    <source src="{{ url_for('static', filename='video/luana.mp4') }}" type="video/mp4">
                                </video>
                            </div>
                            <div class="ratio ratio-16x9 mb-3">
                                <video controls preload="metadata">
                                    <source src="{{ url_for('static', filename='video/wanderson.mp4') }}" type="video/mp4">
                                </video>
                            </div>
                            <div class="ratio ratio-16x9 mb-3">
                                <video controls preload="metadata">
                                    <source src="{{ url_for('static', filename='video/lucca.mp4') }}" type="video/mp4">
                                </video>
                            </div>
                            <div class="ratio ratio-16x9">
                                <video controls preload="metadata">
                                    <source src="{{ url_for('static', filename='video/stephanie.mp4') }}" type="video/mp4">
                                </video>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            break;

        case 'Duvidas Frequentes':
            content = `
                <div class="message bot-message">
                    <div class="message-content">
                        
                        <div class="message-text">
                            <h5><i class="bi bi-question-circle"></i> D√∫vidas Frequentes</h5>
                            <div class="typed-text mb-3">
                                <p>‚ùìConfira abaixo as d√∫vidas frequentes! <br>Separei as perguntas mais comuns para te ajudar a entender melhor como as coisas funcionam por aqui.</p>
                            </div>
                            <div class="accordion" id="faqAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseOne" aria-expanded="false" aria-controls="faqCollapseOne">
                                            Como √© feita a avalia√ß√£o de desempenho?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseOne" class="accordion-collapse collapse" aria-labelledby="faqHeadingOne" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>Temos um programa de avalia√ß√£o de desempenho anual. Atrav√©s da avalia√ß√£o 360¬∞, todos contribuem para o desenvolvimento dos nossos colaboradores.</p>
                                            <p>A avalia√ß√£o √© dividida em 3 etapas:</p>
                                            <ul>
                                                <li>üë§ Avalia√ß√£o do L√≠der ‚Äì 75%</li>
                                                <li>ü§ù Avalia√ß√£o dos Pares ‚Äì 15%</li>
                                                <li>ü™û Autoavalia√ß√£o ‚Äì 10%</li>
                                            </ul>
                                            <p>Ap√≥s essas etapas, o colaborador √© submetido ao f√≥rum de valida√ß√£o, onde os resultados s√£o analisados e discutidos com a lideran√ßa.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingTwo">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseTwo" aria-expanded="false" aria-controls="faqCollapseTwo">
                                            A empresa realiza eventos, confraterniza√ß√µes?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseTwo" class="accordion-collapse collapse" aria-labelledby="faqHeadingTwo" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>Sim! Valorizamos o bem-estar e o engajamento da equipe. Realizamos eventos internos, datas comemorativas, confraterniza√ß√µes de fim de ano e outras iniciativas para promover a integra√ß√£o entre os colaboradores.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingThree">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseThree" aria-expanded="false" aria-controls="faqCollapseThree">
                                            Como s√£o as pol√≠ticas de f√©rias, faltas e pontualidade?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseThree" class="accordion-collapse collapse" aria-labelledby="faqHeadingThree" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p><strong>F√©rias:</strong> Seguem a legisla√ß√£o trabalhista, com direito a 30 dias ap√≥s 12 meses de trabalho.</p>
                                            <p><strong>Faltas:</strong> Devem ser justificadas com anteced√™ncia sempre que poss√≠vel. Faltas n√£o justificadas podem impactar na avalia√ß√£o de desempenho.</p>
                                            <p><strong>Pontualidade:</strong> A pontualidade √© fundamental para o bom andamento das atividades. Atrasos frequentes tamb√©m podem influenciar em avalia√ß√µes internas.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingFour">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseFour" aria-expanded="false" aria-controls="faqCollapseFour">
                                            Quais sistemas ou plataformas vou usar no dia a dia?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseFour" class="accordion-collapse collapse" aria-labelledby="faqHeadingFour" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>Os sistemas variam de acordo com a √°rea de atua√ß√£o, mas alguns dos mais utilizados s√£o:</p>
                                            <ul>
                                                <li>Plataformas de comunica√ß√£o interna (como Microsoft Teams ou Slack)</li>
                                                <li>Ferramentas de produtividade (como Google Workspace, Microsoft Office, etc.)</li>
                                                <li>Sistemas espec√≠ficos da √°rea (ser√£o apresentados no seu onboarding)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingFive">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseFive" aria-expanded="false" aria-controls="faqCollapseFive">
                                            H√° oportunidades de crescimento e promo√ß√µes internas?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseFive" class="accordion-collapse collapse" aria-labelledby="faqHeadingFive" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>Sim! Incentivamos o desenvolvimento interno e priorizamos a promo√ß√£o de talentos da casa. O desempenho, comprometimento e habilidades demonstradas s√£o levados em conta em processos de crescimento profissional.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingSix">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseSix" aria-expanded="false" aria-controls="faqCollapseSix">
                                            Como √© feita a avalia√ß√£o de desempenho? (vis√£o geral)
                                        </button>
                                    </h2>
                                    <div id="faqCollapseSix" class="accordion-collapse collapse" aria-labelledby="faqHeadingSix" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>As avalia√ß√µes s√£o realizadas periodicamente e envolvem an√°lise de metas, compet√™ncias, comportamento e alinhamento com os valores da empresa. Em alguns casos, utilizamos feedbacks 360¬∫ e reuni√µes com a lideran√ßa.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="faqHeadingSeven">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseSeven" aria-expanded="false" aria-controls="faqCollapseSeven">
                                            Existem treinamentos ou cursos oferecidos pela empresa?
                                        </button>
                                    </h2>
                                    <div id="faqCollapseSeven" class="accordion-collapse collapse" aria-labelledby="faqHeadingSeven" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <p>Sim! Oferecemos treinamentos internos e externos, al√©m de parcerias com plataformas de ensino. O objetivo √© capacitar os colaboradores e prepar√°-los para novos desafios e oportunidades dentro da empresa.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            break;
    }
    
    // Create message container
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message bot-message';
    messageDiv.innerHTML = content;
    messagesContainer.appendChild(messageDiv);
    
    // Type the content with effect
    const typedTarget = messageDiv.querySelector('.typed-text') || messageDiv.querySelector('.message-text');
    typeWriter(typedTarget, typedTarget.innerHTML || content);

    // Ativa spinner at√© o v√≠deo estar pronto (quem-somos / feedbacks)
    const holders = messageDiv.querySelectorAll('.video-holder');
    holders.forEach(holder => {
        const spinner = holder.querySelector('.video-spinner');
        const video = holder.querySelector('video');
        if (!video || !spinner) return;

        // Mostrar o player imediatamente (sem aguardar eventos), mas manter spinner por 300ms
        video.style.opacity = '1';
        setTimeout(() => {
            spinner.style.display = 'none';
        }, 300);

        // Caso o navegador demore, garantimos esconder o spinner quando puder tocar
        const hideOnReady = () => { spinner.style.display = 'none'; };
        video.addEventListener('canplay', hideOnReady, { once: true });
        video.addEventListener('loadedmetadata', hideOnReady, { once: true });
    });
}

function typeWriter(element, fullContent) {
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = fullContent;
    const fullText = tempDiv.textContent || tempDiv.innerText || '';
    
    element.innerHTML = '';
    element.classList.add('typing');
    
    let i = 0;
    let currentText = '';
    const step = fullText.length > 800 ? 2 : 1; // escrever 1-2 chars por ciclo
    
    function typeChar() {
        if (i < fullText.length) {
            currentText += fullText.slice(i, i + step);
            element.innerHTML = currentText;
            i += step;
            
            // Levemente mais lento, mantendo varia√ß√£o natural
            const delay = Math.random() * 12 + 12; // 12-24ms
            setTimeout(typeChar, delay);
        } else {
            // After typing is complete, show the formatted content
            element.classList.remove('typing');
            element.innerHTML = tempDiv.innerHTML;
            
            // Scroll to bottom after content is fully loaded
            setTimeout(() => {
                const messagesContainer = document.getElementById('chatbotMessages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
    }
    
    // Start typing after a small delay
    setTimeout(typeChar, 100);
}
</script>
{% endblock %}
